<div class="files-page card">
    <div class="files-area" *ngIf="filesList!==undefined">
        <p-table #dt1 
            [value]="filesList!" 
            sortMode="multiple" 
            [globalFilterFields]="['name', 'modifier', 'nbEvent', 'description']" 
            [scrollable]="true" 
            scrollHeight="flex"
        >
            <ng-template pTemplate="caption">
                <div class="caption-area">
                    <div class="caption-text-area">
                        <span class="caption-text">{{folderInfo?.name}}</span>
                        <span class="p-input-icon-left ml-auto">
                            <i class="pi pi-search"></i>
                            <input pInputText type="text" [(ngModel)]="filterText" (input)="onInputFilter($event)" placeholder="Search keyword" />
                        </span>
                        <button pButton label="Clear" class="p-button-outlined" icon="pi pi-filter-slash" (click)="clear(dt1)"></button>
                    </div>
                    <div class="table-buttons-area">
                        <!-- <p-button icon="pi pi-directions-alt" (onClick)="onClickParent($event)" [rounded]="true" [text]="true"></p-button> -->
                        <p-button icon="pi pi-upload" (onClick)="onClickUploadFiles($event)" [rounded]="true" [text]="true"></p-button>
                        <p-button icon="pi pi-download" (onClick)="onClickDownload($event)" [rounded]="true" [text]="true"></p-button>
                        <p-button icon="pi pi-file-import" (onClick)="onClickImportLabels($event)" [rounded]="true" [text]="true"></p-button>
                        <input id="fileImportInput" type="file" class="file-input" (change)="onChangeImportInput($event)" style="display: none;" accept=".json" [multiple]="false">
                        <p-button icon="pi pi-file-export" (onClick)="onClickExportLabels($event)" [rounded]="true" [text]="true"></p-button>
                        <p-button icon="pi pi-share-alt" (onClick)="onClickShareFolder($event)" [rounded]="true" [text]="true"></p-button>
                        <p-button icon="pi pi-refresh" (onClick)="onClickRefresh($event)" [rounded]="true" [text]="true"></p-button>
                    </div>
                </div>
            </ng-template>
            <ng-template pTemplate="header">
                <tr>
                    <th pSortableColumn="name" style="width: 30%;">Name <p-sortIcon field="name"></p-sortIcon></th>
                    <th pSortableColumn="parsing" style="width: 10%;"> Parsing 
                        <p-sortIcon field="parsing"> </p-sortIcon>
                        <p-button icon="pi pi-replay" (onClick)="onClickReparsing($event)" [rounded]="true" [text]="true"></p-button> 
                    </th>
                    <th pSortableColumn="lastModifier" style="width: 10%;"> Last modifier <p-sortIcon field="lastModifier"></p-sortIcon></th>
                    <th pSortableColumn="lastUpdate" style="width: 10%;"> Last update <p-sortIcon field="lastUpdate"></p-sortIcon></th>
                    <th pSortableColumn="nbEvent" style="width: 20%;">Nb Event <p-sortIcon field="nbEvent"></p-sortIcon></th>
                    <th pSortableColumn="description" style="width: 15%;">Description<p-sortIcon field="description"></p-sortIcon></th>
                    <th style="width: 5%;"></th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-file let-index>
                <tr>
                    <td><span (click)="onClickFile($event, file)" style="cursor: pointer;">{{file.name}}</span></td>
                    <td>{{file.parsing}}</td>
                    <td>{{file.lastModifier===undefined?'unknown':file.lastModifier}}</td>
                    <td>{{file.lastUpdate===undefined?'unknown':file.lastUpdate.$date|date:'short'}}
                    <td>{{file.nbEvent}}</td>
                    <td>
                        {{file.description}}
                        <p-button icon="pi pi-pencil" (onClick)="onClickEditDescription($event, file)" [rounded]="true" [text]="true"></p-button>
                    </td>
                    <td>
                        <p-button icon="pi pi-times" (onClick)="onClickRemove($event, file)" [rounded]="true" [text]="true"></p-button>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>
<p-speedDial direction="down-right" type="quarter-circle" (onClick)="onClickUploadFiles($event)" [rotateAnimation]="false"></p-speedDial>
<p-toast></p-toast>
<p-confirmPopup></p-confirmPopup>
<p-dialog
    [closable]="false"
    [modal]="true"
    [visible]="uploadFileDialogVisible">
        <ng-template pTemplate="header">
            Upload File
            <p-button icon="pi pi-times" (onClick)="onClickDialogCancel($event, 'uploadFileDialog')" [rounded]="true" [text]="true"></p-button>
        </ng-template>
        <p-fileUpload #fileUpload
            name="fileUpload" 
            [multiple]="true" 
            [customUpload]="true"
            (uploadHandler)="onFileUploadClick($event)">
                <ng-template pTemplate="toolbar">
                    Drag and drop files
                </ng-template>
                <ng-template pTemplate="content">
                    <ul *ngIf="fileUpload.progress===100">
                        <li *ngFor="let file of uploadedFileNames">{{file}}</li>
                    </ul>
                </ng-template>
        </p-fileUpload>
</p-dialog>
<p-dialog
    header="Share folder"
    [closable]="false"
    [modal]="true"
    [visible]="shareDialogVisible">
        <div class="dialog-body">
            <div class="user-selection-area">
                <p>Choose a user</p>
                <p-dropdown
                    [options]="usersList"
                    [(ngModel)]="selectedUser"
                    optionLabel="mail"
                    appendTo="body"
                ></p-dropdown>
            </div>
            <div class="sharing-message-area">
                <label for="sharingMessage">Sharing message</label>
                <input id="sharingMessage" type="text" pInputText [(ngModel)]="messageShared">
            </div>
            <div class="dialog-buttons-area">
                <div class="placeholder"></div>
                <div class="buttons-right">
                    <p-button icon="pi pi-check" (onClick)="onClickShareOK($event)" [rounded]="true" [text]="true"></p-button>
                    <p-button icon="pi pi-times" (onClick)="onClickDialogCancel($event, 'shareFolder')" [rounded]="true" [text]="true"></p-button>
                </div>
            </div>
        </div>
</p-dialog>

<p-dialog
    header="Edit description"
    [closable]="false"
    [modal]="true"
    [visible]="descriptionDialogVisible">
        <div class="dialog-body">
            <div class="user-selection-area">
                <label for="description">Description</label>
                <input id="description" type="text" pInputText [(ngModel)]="selectedFileDescription">
            </div>
            <div class="dialog-buttons-area">
                <div class="placeholder"></div>
                <div class="buttons-right">
                    <p-button icon="pi pi-check" (onClick)="onClickEditDescriptionOK($event)" [rounded]="true" [text]="true"></p-button>
                    <p-button icon="pi pi-times" (onClick)="onClickDialogCancel($event, 'description')" [rounded]="true" [text]="true"></p-button>
                </div>
            </div>
        </div>
</p-dialog>
<p-dialog
    header="Download"
    [closable]="false"
    [modal]="true"
    [visible]="downloadDialogVisible"
    [style]="{width: '50vw'}">
        <div class="dialog-body">
            <div class="user-selection-area">
                <a title="Download JSON" [href]="downloadUri" download="download.json" (click)="onClickDialogCancel($event, 'download')">Download</a>
            </div>
            <div class="dialog-buttons-area">
                <div class="placeholder"></div>
                <div class="buttons-right">
                    <p-button icon="pi pi-times" (onClick)="onClickDialogCancel($event, 'download')" [rounded]="true" [text]="true"></p-button>
                </div>
            </div>
        </div>
</p-dialog>