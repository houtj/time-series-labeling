<div class="auto-detection-container">
  <div class="panel-content">
    <!-- Scrollable inference log -->
    <div class="inference-log" #inferenceLog>
      @if (inferenceHistory().length === 0) {
        <div class="log-empty">
          <i class="pi pi-info-circle" style="font-size: 3rem;"></i>
          <h4>No inference data yet</h4>
          <p>Click "Start" to begin auto-annotation. The agent will analyze your data and suggest labels.</p>
        </div>
      } @else {
        @for (log of inferenceHistory(); track $index) {
          <div class="log-entry" [ngClass]="'log-' + log.type">
            <div class="log-header">
              <div class="log-icon">
                <i [class]="getLogIcon(log.type)"></i>
              </div>
              <div class="log-meta">
                <span class="log-timestamp">{{ formatTimestamp(log.timestamp) }}</span>
                <span class="log-type">{{ log.type }}</span>
              </div>
            </div>
            <div class="log-message">
              @if (log.type === 'sent-message') {
                <span class="message-label">ðŸ’¬ Sent:</span>
              }
              @if (log.type === 'received-message') {
                <span class="message-label">ðŸ¤– Response:</span>
              }
              @if (log.type === 'agent-header') {
                <span class="agent-name">{{ log.message }}</span>
              } @else {
                {{ log.message }}
              }
            </div>
            @if (log.details && log.type !== 'agent-header') {
              <div class="log-details">
                @if (log.type === 'agent-reasoning') {
                  <div class="reasoning-details">
                    @for (item of objectEntries(log.details); track item.key) {
                      <div class="detail-section">
                        <div class="detail-label">{{ item.key }}:</div>
                        <div class="detail-content">{{ item.value }}</div>
                      </div>
                    }
                  </div>
                } @else {
                  <pre>{{ formatDetails(log.details) }}</pre>
                }
              </div>
            }
          </div>
        }
      }
      
      @if (isRunning()) {
        <div class="log-entry log-running">
          <div class="log-header">
            <div class="log-icon">
              <i class="pi pi-spin pi-spinner"></i>
            </div>
            <div class="log-meta">
              <span class="log-type">Running...</span>
            </div>
          </div>
          <div class="log-message">
            Agent is processing data and generating labels...
          </div>
        </div>
      }
    </div>
    
    <!-- Fixed plan display at bottom -->
    @if (currentPlan().length > 0) {
      <div class="plan-display">
        <div class="plan-header">
          <div class="plan-title">
            <i class="pi pi-list-check"></i>
            <span>Execution Plan</span>
          </div>
          <div class="plan-progress">
            {{ getCompletedTasksCount() }} / {{ currentPlan().length }} completed
          </div>
        </div>
        <div class="plan-items">
          @for (task of currentPlan(); track task.task_id) {
            <div class="plan-item" [class.completed]="task.is_done">
              <div class="plan-item-checkbox">
                @if (task.is_done) {
                  <i class="pi pi-check-circle"></i>
                } @else {
                  <i class="pi pi-circle"></i>
                }
              </div>
              <div class="plan-item-content">
                <div class="plan-item-description">{{ task.task_description }}</div>
                <div class="plan-item-meta">
                  <span class="plan-item-type" [class.identification]="task.task_type === 'identification'" [class.verification]="task.task_type === 'verification'">
                    {{ task.task_type }}
                  </span>
                  <span class="plan-item-id">{{ task.task_id }}</span>
                </div>
              </div>
            </div>
          }
        </div>
      </div>
    }
  </div>
</div>
