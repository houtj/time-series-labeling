<div class="labeling-page">
  <!-- Labeling Toolbar -->
  <app-labeling-toolbar 
    [fileId]="fileId"
    [folderId]="folderId"
    [fileInfo]="fileInfo"
    [folderInfo]="folderInfo"
    [labelInfo]="labelInfo"
    [projectInfo]="projectInfo()"
    (onSave)="onSaveLabels()"
    (onShare)="onShareFolder()"
    (onImport)="onImportLabels()"
    (onExport)="onExportLabels()"
    (onDownload)="onDownloadData()"
    (onEditDescriptions)="onEditDescriptions()"
    (onAutoAnnotate)="onAutoAnnotate()"
    (onToggleAiChat)="onToggleAiChat()"
  />
  
  <!-- Main Splitter: Chart + Panels -->
  <p-splitter 
    [style]="{ height: '100%', width:'100%'}" 
    layout="vertical" 
    class="splitter-area" 
    (onResizeEnd)="onResizePlot()"
  >
    <!-- Chart Area -->
    <ng-template pTemplate>
      <div class="chart-area">
        <app-chart 
          [data]="data"
          [labelInfo]="labelInfo"
        />
      </div>
    </ng-template>
    <!-- Bottom Panels Area -->
    <ng-template pTemplate>
      <div class="panels-area">
        @if (labelInfo) {
          <div class="panels-container">
            <!-- Left Side: Guidelines Tab (with optional AI/Agent tabs) -->
            <div class="left-tabs">
              <p-tabs value="0">
                <p-tablist>
                  <p-tab value="0">
                    <i class="pi pi-list"></i>
                    <span>Guidelines</span>
                  </p-tab>
                  @if (aiChatVisible) {
                    <p-tab value="1">
                      <i class="pi pi-comments"></i>
                      <span>AI Assistant</span>
                      <button (click)="onAiChatClose(); $event.stopPropagation()" class="tab-close-btn">
                        <i class="pi pi-times"></i>
                      </button>
                    </p-tab>
                  }
                  @if (autoDetectionVisible) {
                    <p-tab [value]="aiChatVisible ? '2' : '1'">
                      <i class="pi pi-cog"></i>
                      <span>Auto-Detection</span>
                      <button (click)="onAutoDetectionClose(); $event.stopPropagation()" class="tab-close-btn">
                        <i class="pi pi-times"></i>
                      </button>
                    </p-tab>
                  }
                </p-tablist>
                <p-tabpanels>
                  <p-tabpanel value="0">
                    <app-guidelines-panel 
                      [labelInfo]="labelInfo"
                      (onRefresh)="onRefreshPage()"
                    />
                  </p-tabpanel>
                  @if (aiChatVisible) {
                    <p-tabpanel value="1">
                      <app-ai-chat-tab (onClose)="onAiChatClose()" />
                    </p-tabpanel>
                  }
                  @if (autoDetectionVisible) {
                    <p-tabpanel [value]="aiChatVisible ? '2' : '1'">
                      <app-auto-detection-panel 
                        [fileId]="fileId"
                        [folderId]="folderId"
                        [projectId]="projectInfo()?._id?.$oid"
                        (onClose)="onAutoDetectionClose()"
                      />
                    </p-tabpanel>
                  }
                </p-tabpanels>
              </p-tabs>
            </div>

            <!-- Right Side: Events Panel -->
            <div class="right-panel">
              <app-events-panel 
                [labelInfo]="labelInfo"
                (onRefresh)="onRefreshPage()"
                (onEditDescription)="onEditEventDescription($event)"
              />
            </div>
          </div>
        } @else {
          <div class="empty-state">
            <i class="pi pi-info-circle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
            <p>No label data available</p>
          </div>
        }
      </div>
    </ng-template>
  </p-splitter>
</div>

<!-- Share Dialog -->
<app-share-dialog
  [(visible)]="shareDialogVisible"
  [title]="'Share Folder'"
  [resourceType]="'folder'"
  [resourceName]="folderInfo?.name || ''"
  (onShare)="onShareFolderConfirm($event)"
/>

<!-- Description Dialog -->
<app-description-dialog
  [(visible)]="descriptionDialogVisible"
  [title]="'Edit Event Description'"
  [resourceName]="selectedEvent?.className || ''"
  [description]="selectedEventDescription"
  [placeholder]="'Add notes about this event...'"
  [maxLength]="500"
  [rows]="5"
  (onSave)="onSaveEventDescription($event)"
/>

<!-- Toast for notifications -->
<p-toast />
